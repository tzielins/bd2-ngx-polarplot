{"version":3,"file":"main.js","mappings":"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","sources":["./projects/bd2-ngx-polarplot-demo/src/app/app.component.ts","./projects/bd2-ngx-polarplot-demo/src/app/app.component.html","./projects/bd2-ngx-polarplot-demo/src/app/app.module.ts","./projects/bd2-ngx-polarplot-demo/src/environments/environment.ts","./projects/bd2-ngx-polarplot-demo/src/main.ts","./projects/bd2-ngx-polarplot/src/lib/polar-plot-utils/color-palette.ts","./projects/bd2-ngx-polarplot/src/lib/d3service/d3.service.ts","./projects/bd2-ngx-polarplot/src/lib/d3service/index.ts","./projects/bd2-ngx-polarplot/src/lib/polar-plot-utils/polar-plot.dom.ts","./projects/bd2-ngx-polarplot/src/lib/polar-plot-utils/smart-rounding.ts","./projects/bd2-ngx-polarplot/src/lib/polar-plot-utils/polar-domain-util.ts","./projects/bd2-ngx-polarplot/src/lib/polar-plot/polar-plot.dom.ts","./projects/bd2-ngx-polarplot/src/lib/polar-plot/polar-plot.component.ts","./projects/bd2-ngx-polarplot/src/lib/bd2-ngx-polarplot.module.ts","./projects/bd2-ngx-polarplot/src/public-api.ts","./projects/bd2-ngx-polarplot/src/bd2-ngx-polarplot.ts"],"sourcesContent":["import { Component } from '@angular/core';\nimport {interval, Subscription} from 'rxjs';\nimport {take} from 'rxjs/operators';\nimport {BD2ColorPalette} from '../../../bd2-ngx-polarplot/src/lib/polar-plot-utils/color-palette';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent {\n  title = 'bd2-ngx-polarplot-app';\n\n  data: number[][];\n  labels: string[] = [];\n  removed: number[] = [];\n\n  domain = [0, 24];\n  indiv = 'selected';\n  hidden = false;\n\n  show = 'selected';\n  i = 0;\n\n  labelsOn = true;\n  scaleRadius = true;\n  scaleWidth = false;\n\n  palette: string[];\n\n  constructor() {\n\n    this.generateData();\n\n\n  }\n\n  toggleRemoved() {\n    if (this.removed.length === 0) {\n      this.removed = [0, 3];\n    } else {\n      this.removed = [];\n    }\n  }\n\n  toggleHidden() {\n    this.hidden = !this.hidden;\n  }\n\n  value() {\n    console.log('V called ' + this.i++);\n    return this.show;\n  }\n\n  // for testing fast changing data\n  generateDelayedData() {\n    let s: Subscription;\n    s = interval(1000).pipe(\n      take(3)\n    ).subscribe( v => this.generateDataInner(1, 15), err => {}, () => {\n      if (s) { s.unsubscribe(); }\n    });\n  }\n\n  generateData() {\n    // this.generateDataInner(1, 6);\n    this.generateDelayedData();\n  }\n\n  generateDataInner(nrBase = 1, increase = 5): number[][] {\n    const series = Math.floor((Math.random() * increase) + nrBase);\n\n    const rows: number[][] = [];\n    rows.push([-23.4, 1, 25.2, 48.7, 73.1]);\n    rows.push([22.5, 21.5, 20.6]);\n    rows.push([]);\n    for (let i = 0; i < series; i++) {\n\n      const len = Math.floor((Math.random() * 5) + 1);\n      const err = Math.random() * 7;\n      const mean = Math.random() * 24;\n\n      const row = [];\n      for (let j = 0; j < len; j++) {\n        let x = mean + (0.5 - Math.random()) * err;\n        x = Math.round(x * 10) / 10;\n        row.push(x);\n      }\n      rows.push(row);\n    }\n\n\n    const LET = 'ABCDEFGHIJKLMN abcdef';\n    const labels = rows.map((v, ix) => {\n\n      const s = Math.random() * 30 + 3;\n      let label = (ix + 1) + '. '; //\n      for (let i = 0; i < s; i++) {\n        label += LET[Math.round(Math.random() * (LET.length - 1))];\n      }\n      // label += \" \" + ;\n\n      return label;\n    });\n\n    this.labels = labels;\n    this.data = rows;\n\n    this.palette = Math.random() > 0.2 ? BD2ColorPalette.palette(10) : ['blue'];\n    return rows;\n  }\n\n}\n","<div class=\"container central-area\">\n  <div class=\"row\">\n\n    <div class=\"col-md-12\">\n      <h1>\n        Polar plot demo. V 2.2.0\n      </h1>\n\n      <div>\n        <p>\n          Simple demo of circadian polar plot. It is not a polar plot in the sense of polar coordinates (radius/angle),\n          but it represents \"cyclic data\" i.e. modulo domain range.\n        </p>\n        <p>Generated data always contains fixed two first series: first one demonstrate data with peak times ~(1h+n24h),\n          second a simple data spread.</p>\n        <p>Petals points to the mean of the input series, their width and radius can be scaled by std dev od the\n          data.</p>\n      </div>\n      <hr>\n    </div>\n  </div>\n  <div class=\"row\">\n\n    <div class=\"col-sm-4\">\n      <div>\n        <div class=\"form-group\">\n          <a class=\"btn btn-primary btn-sm\" (click)=\"toggleRemoved()\">Toggle removed</a>\n          <br>\n          <span>[{{removed}}]</span>\n        </div>\n\n        <div class=\"form-group\">\n          <a class=\"btn btn-primary btn-sm\" (click)=\"generateData()\">generate</a>\n        </div>\n        <div class=\"form-group\">\n          <a class=\"btn btn-primary btn-sm\" (click)=\"toggleHidden()\">toggle hidden</a> {{hidden}}\n        </div>\n\n\n\n\n\n        <div class=\"form-group\">\n          <label>Show individuals</label>\n          <select class=\"form-control\" [(ngModel)]=\"indiv\">\n            <option>none</option>\n            <option>selected</option>\n            <option>all</option>\n          </select>\n        </div>\n\n        <div class=\"form-group\">\n          <label>Scale Radius:</label> <a class=\"btn btn-primary btn-sm\" (click)=\"scaleRadius = !scaleRadius\">\n          {{scaleRadius ? 'On' : 'Off'}}</a>\n        </div>\n        <div class=\"form-group\">\n          <label>Scale Width:</label> <a class=\"btn btn-primary btn-sm\" (click)=\"scaleWidth = !scaleWidth\">\n          {{scaleWidth ? 'On' : 'Off'}}</a>\n        </div>\n      </div>\n\n\n      <div class=\"form-group\">\n        <label>Toogle labels:</label> <a class=\"btn btn-primary btn-sm\" (click)=\"labelsOn = !labelsOn\">\n        {{labelsOn ? 'On' : 'Off'}}</a>\n      </div>\n\n    </div>\n\n    <div class=\"col-sm-6\">\n\n      <bd2-ngx-polar-plot\n        [data]=\"data\" [domain]=\"domain\" [showIndividuals]=\"indiv\"\n        [scaleRadius]=\"scaleRadius\" [scaleWidth]=\"scaleWidth\"\n        [hidden]=\"hidden\" [labels]=\"labels\" [labelsOn]=\"labelsOn\"\n        [removed]=\"removed\" [palette]=\"palette\"\n      >\n\n      </bd2-ngx-polar-plot>\n\n    </div>\n\n    <div class=\"col-sm-12\">\n      <div class=\"form-group\">\n        <label>Domain:</label>\n        <span>[{{domain}}]</span>\n      </div>\n\n      <div class=\"form-group\">\n        <label>Data:</label>\n        <ul class=\"list-unstyled\" style=\"margin: 1em;\">\n          <li *ngFor=\"let row of data\">[{{row}}],</li>\n        </ul>\n      </div>\n\n      <div class=\"form-group\">\n        <label>Labels:</label>\n        <ul class=\"list-unstyled\" style=\"margin: 1em;\">\n          <li *ngFor=\"let row of labels\">[{{row}}],</li>\n        </ul>\n      </div>\n\n    </div>\n\n  </div>\n\n</div> <!-- /container -->\n","import { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\n\nimport { AppComponent } from './app.component';\nimport {FormsModule} from '@angular/forms';\nimport {BD2NgxPolarplotModule} from 'bd2-ngx-polarplot';\n\n@NgModule({\n  declarations: [\n    AppComponent\n  ],\n  imports: [\n    BrowserModule,\n    FormsModule,\n    BD2NgxPolarplotModule\n  ],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","// This file can be replaced during build by using the `fileReplacements` array.\n// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.\n// The list of file replacements can be found in `angular.json`.\n\nexport const environment = {\n  production: false\n};\n\n/*\n * For easier debugging in development mode, you can import the following file\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\n *\n * This import should be commented out in production mode because it will have a negative impact\n * on performance if an error is thrown.\n */\n// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err));\n","\r\nexport class BD2ColorPalette {\r\n\r\n  static schemeCategory10 = [\r\n    '#1f77b4',\r\n    '#ff7f0e',\r\n    '#2ca02c',\r\n    '#d62728',\r\n    '#9467bd',\r\n    '#8c564b',\r\n    '#e377c2',\r\n    '#7f7f7f',\r\n    '#bcbd22',\r\n    '#17becf'\r\n  ];\r\n\r\n  static schemeCategory20 = [\r\n'#1f77b4'\r\n, '#aec7e8'\r\n, '#ff7f0e'\r\n, '#ffbb78'\r\n, '#2ca02c'\r\n, '#98df8a'\r\n, '#d62728'\r\n, '#ff9896'\r\n, '#9467bd'\r\n, '#c5b0d5'\r\n, '#8c564b'\r\n, '#c49c94'\r\n, '#e377c2'\r\n, '#f7b6d2'\r\n, '#7f7f7f'\r\n, '#c7c7c7'\r\n, '#bcbd22'\r\n, '#dbdb8d'\r\n, '#17becf'\r\n, '#9edae5'];\r\n\r\n  static extendPalette(palette: string[] | ReadonlyArray<string>, size: number): string[] {\r\n\r\n    if (!palette || palette.length === 0) {\r\n      palette = ['black'];\r\n    }\r\n\r\n    const out = [];\r\n    for (let i = 0; i < size; i++) {\r\n      out.push(palette[i % palette.length]);\r\n    }\r\n    return out;\r\n\r\n  }\r\n\r\n  static palette(size: number): string[] {\r\n\r\n    if (size <= BD2ColorPalette.schemeCategory10.length) {\r\n      return BD2ColorPalette.extendPalette(BD2ColorPalette.schemeCategory10, size);\r\n    } else {\r\n      return BD2ColorPalette.extendPalette(BD2ColorPalette.schemeCategory20, size);\r\n    }\r\n\r\n  }\r\n}\r\n","import * as d3lib from 'd3';\r\n\r\nexport type D3 = typeof d3lib;\r\nexport const d3 = d3lib;\r\n\r\n/**\r\n D3 integration was originally based on the code for npm library: d3-ng2-service\r\n by Tom Wanzek, https://github.com/tomwanzek/d3-ng2-service.\r\n\r\n That package was used during developement and then converted into inline service\r\n to reduce the dependencies and boundle size.\r\n\r\n At some point, I moved to to simpler dependency on d3:\r\n npm install --save d3\r\n npm install --save-dev @types/d3\r\n\r\n and removed the parts from d3-modules.ts as they were causing errors\r\n (not sure how to fix them and also one dependency is easier to maintain).\r\n */\r\n","export * from './d3.service';\r\n\r\n/*\r\n// that has been removed after importing a single d3 dependency\r\n\r\nexport {\r\n  // d3-array\r\n  Bin,\r\n  Bisector,\r\n  HistogramGenerator,\r\n  Numeric,\r\n  ThresholdArrayGenerator,\r\n  ThresholdCountGenerator,\r\n  // d3-axis\r\n  Axis,\r\n  AxisContainerElement,\r\n  AxisScale,\r\n  AxisTimeInterval,\r\n  // d3-scale\r\n  InterpolatorFactory,\r\n  ScaleBand,\r\n  ScaleIdentity,\r\n  ScaleLinear,\r\n  ScaleLogarithmic,\r\n  ScaleOrdinal,\r\n  ScalePoint,\r\n  ScalePower,\r\n  ScaleQuantile,\r\n  ScaleQuantize,\r\n  ScaleSequential,\r\n  ScaleThreshold,\r\n  ScaleTime,\r\n\r\n  // d3-selection\r\n  ArrayLike,\r\n  BaseEvent,\r\n  BaseType,\r\n  ContainerElement,\r\n  EnterElement,\r\n  Local,\r\n  NamespaceLocalObject,\r\n  NamespaceMap,\r\n  Selection,\r\n  SelectionFn,\r\n  TransitionLike,\r\n  ValueFn,\r\n  // d3-selection-multi\r\n  ValueMap,\r\n  // d3-shape\r\n  Arc,\r\n  Area,\r\n  DefaultArcObject,\r\n  Line,\r\n  Pie,\r\n  PieArcDatum,\r\n  RadialArea,\r\n  RadialLine,\r\n  Series,\r\n  SeriesPoint,\r\n  Stack,\r\n  Symbol,\r\n  SymbolType,\r\n  // d3-transition\r\n  Transition\r\n} from './d3-modules';\r\n\r\n\r\n */\r\n","\r\n\r\nexport class PolarPoint {\r\n  constructor(public xy: number[], public color: string, public hidden?: boolean) {}\r\n}\r\n\r\nexport class PetalNode {\r\n\r\n  peak: number;\r\n  roundedPeak: number;\r\n  width: number;\r\n  radiusScale: number;\r\n  polarAngle: number;\r\n  polarCoordinates: number[];\r\n  petalPath: number[][];\r\n\r\n  label: string;\r\n  color: string;\r\n  hidden: boolean;\r\n\r\n  individuals: PolarPoint[] = [];\r\n}\r\n\r\n","\r\nexport class SmartRounder {\r\n\r\n  static round(value: number, base?: number): number {\r\n\r\n    base = base || value;\r\n    base = Math.abs(base);\r\n\r\n    if (base < 0.01) {\r\n      return value;\r\n    }\r\n\r\n    if (base < 1) {\r\n      return Math.round(value * 10000) / 10000;\r\n    }\r\n\r\n    if (base < 1000) {\r\n      return Math.round(value * 100) / 100;\r\n    }\r\n    return Math.round(value);\r\n  }\r\n\r\n\r\n}\r\n","import {PetalNode, PolarPoint} from './polar-plot.dom';\r\nimport {d3} from '../d3service';\r\nimport {SmartRounder} from './smart-rounding';\r\n\r\n\r\nconst DEF_ERR = 0.6 / 24;\r\nconst DEF_WIDTH = 0.6 / 24;\r\nconst MIN_WIDTH = 0.1 / 24;\r\nconst NEGLIGIBLE_ERROR = 0.5 / 24;\r\nconst MAX_ERROR = 0.33; // 8/24\r\n\r\nexport class PolarDomainUtil {\r\n\r\n  dataToPetals(dataGroups: number[][], domain: number[],\r\n               scaleRadius?: boolean, scaleWidth?: boolean, errors?: number[]): PetalNode[] {\r\n\r\n    if (!dataGroups) {\r\n      return [];\r\n    }\r\n    domain[2] = domain[1] - domain[0];\r\n\r\n    return dataGroups.map((g, ix) => this.dataToPetal(g, domain, scaleRadius, scaleWidth, errors ? errors[ix] : null));\r\n  }\r\n\r\n  dataToPetal(data: number[], domain: number[],\r\n              scaleRadius?: boolean, scaleWidth?: boolean, error?: number): PetalNode {\r\n\r\n\r\n    const node = this.calculatePetalProperties(data, domain, scaleRadius, scaleWidth, error);\r\n    node.polarAngle = this.calculatePolarAngle(node.peak, domain);\r\n    node.petalPath = this.calculatePetalPath(node.peak, node.width, node.radiusScale, domain);\r\n    node.polarCoordinates = this.calculatePolarCoordinate(node.peak, domain);\r\n\r\n    // shift back after normalization\r\n    node.peak = node.peak + domain[0];\r\n\r\n    node.individuals = this.dataToPolarPoint(data, domain);\r\n    return node;\r\n  }\r\n\r\n  dataToPolarPoint(data: number[], domain: number[]): PolarPoint[] {\r\n\r\n    const ind = data.map(a => {\r\n      const v = new PolarPoint(this.calculatePolarCoordinate(a, domain), undefined);\r\n      return v;\r\n    });\r\n\r\n    return ind;\r\n  }\r\n\r\n  calculateCircularMeanAndDev(data: number[], domain: number[]) {\r\n\r\n    data = data.map(v => this.normalize(v, domain));\r\n    const m = d3.mean(data);\r\n    const std = d3.deviation(data) || 0;\r\n\r\n    const rot = domain[2] / 2;\r\n    data = data.map(v => v < rot ? v + domain[2] : v);\r\n    const rotM = d3.mean(data) % domain[2];\r\n    const rotStd = d3.deviation(data) || 0;\r\n\r\n    if (rotStd < std) {\r\n      return [rotM, rotStd];\r\n    } else {\r\n      return [m, std];\r\n    }\r\n  }\r\n\r\n  calculatePetalProperties(data: number[], domain: number[],\r\n                           scaleRadius?: boolean, scaleWidth?: boolean, error?: number): PetalNode {\r\n\r\n    const node = new PetalNode();\r\n\r\n    const meanStd = this.calculateCircularMeanAndDev(data, domain);\r\n\r\n    node.peak = meanStd[0];\r\n    node.roundedPeak = SmartRounder.round(node.peak);\r\n\r\n    if ((scaleRadius || scaleWidth) && !error) {\r\n      error = meanStd[1];\r\n    }\r\n\r\n\r\n    node.width = scaleWidth ? error : DEF_WIDTH * domain[2];\r\n    if (node.width < MIN_WIDTH * domain[2]) {\r\n      node.width = MIN_WIDTH * domain[2];\r\n    }\r\n    if (node.width > domain[2] / 2) {\r\n      node.width = domain[2] / 2;\r\n    }\r\n\r\n    node.radiusScale = 1;\r\n    if (scaleRadius) {\r\n      error = error / domain[2];\r\n      error = error <= NEGLIGIBLE_ERROR ? 0 : error;\r\n      error = error > MAX_ERROR ? MAX_ERROR : error;\r\n\r\n      node.radiusScale = 1 - 0.5 * error / MAX_ERROR;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n\r\n  calculatePetalPath(peak: number, width: number, radiusScale: number, domain: number[]): number[][] {\r\n\r\n    const path = [\r\n      [0, 0],\r\n      [0.5 * radiusScale, this.calculatePolarAngle(peak - width, domain)],\r\n      [1 * radiusScale, this.calculatePolarAngle(peak, domain)],\r\n      [0.5 * radiusScale, this.calculatePolarAngle(peak + width, domain)],\r\n    ];\r\n    return path;\r\n\r\n  }\r\n\r\n\r\n  normalize(value: number, domain: number[]): number {\r\n    value = value - domain[0];\r\n    value = value % domain[2];\r\n    if (value < 0) {\r\n      value += domain[2];\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  calculatePolarCoordinate(value: number, domain: number[]): number[] {\r\n    value = this.normalize(value, domain);\r\n\r\n    return this.normalizedPeakToPolar(value, domain[2]);\r\n  }\r\n\r\n  normalizedPeakToPolar(value: number, range: number): number[] {\r\n    return [\r\n      Math.cos(value * 2 * Math.PI / range - Math.PI / 2),\r\n      Math.sin(value * 2 * Math.PI / range - Math.PI / 2),\r\n      value\r\n    ];\r\n  }\r\n\r\n  calculatePolarAngle(value: number, domain: number[]): number {\r\n    value = this.normalize(value, domain);\r\n\r\n    return value * 2 * Math.PI / domain[2];\r\n  }\r\n}\r\n","import {Selection} from 'd3-selection';\r\n\r\nexport type ShowIndividualsOptions = 'none' | 'all' | 'selected';\r\n\r\nexport class GraphicContext {\r\n\r\n  palette: string[];\r\n\r\n  mainPane: Selection<SVGGElement, any, null, undefined>;\r\n  axisGrid: Selection<SVGGElement, any, null, undefined>;\r\n  petalsWrapper: Selection<SVGGElement, any, null, undefined>;\r\n  dotsWrapper: Selection<SVGGElement, any, null, undefined>;\r\n  individualDotsInsetWrapper: Selection<SVGGElement, any, null, undefined>;\r\n  tooltip: Selection<SVGGElement, any, null, undefined>;\r\n  tooltipText: Selection<SVGGElement, any, null, undefined>;\r\n  tooltipBox: Selection<SVGGElement, any, null, undefined>;\r\n\r\n  legendtip: Selection<SVGGElement, any, null, undefined>;\r\n  legendtipText: Selection<SVGGElement, any, null, undefined>;\r\n  legendtipBox: Selection<SVGGElement, any, null, undefined>;\r\n\r\n  radius: number;\r\n}\r\n\r\nexport class LookAndFeel {\r\n  baseTransitionsTime = 400;\r\n\r\n  gridColor = '#CDCDCD';\r\n  axisColor = 'white';\r\n  axisWidth = '2px';\r\n\r\n  // done by css\r\n  // axisFontSize: \"10px\",\r\n  // tooltipFontSize: \"11px\",\r\n\r\n  dotsCircleRadius = 4;\r\n  dotsCircleStrokeWidth = '1px';\r\n  dotsCircleFillOpacity = 0.5;\r\n\r\n  petalAreaOpacity = 0.35;\r\n  petalAreaOpacityActive = 0.7;\r\n  petalLineWidth = '3px';\r\n  petalCircleRadius = 4;\r\n  petalCircleOpacity = 0.8;\r\n\r\n}\r\n","import {\n  AfterViewInit,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  Input,\n  Output,\n  EventEmitter,\n  NgZone,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  SimpleChanges\n} from '@angular/core';\nimport {D3, d3} from '../d3service';\nimport {Selection} from 'd3';\nimport {PolarDomainUtil} from '../polar-plot-utils/polar-domain-util';\nimport {SmartRounder} from '../polar-plot-utils/smart-rounding';\nimport {PetalNode, PolarPoint} from '../polar-plot-utils/polar-plot.dom';\nimport {BD2ColorPalette} from '../polar-plot-utils/color-palette';\nimport {GraphicContext, LookAndFeel, ShowIndividualsOptions} from './polar-plot.dom';\nimport {BaseType} from \"d3-selection\";\n\n\n\n\n@Component({\n  selector: 'bd2-ngx-polar-plot',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  template: `\n    <div class=\"polarplot\"></div>\n  `,\n  styles: [\n    `\n      :host ::ng-deep .axis .legend {\n        font-size: 15px;\n      }\n\n      :host ::ng-deep .tooltip {\n        font-size: 15px;\n      }\n\n      :host ::ng-deep .legendtip {\n        font-size: 18px;\n      }\n    `\n  ]\n})\nexport class PolarPlotComponent implements OnInit, AfterViewInit, OnChanges, OnDestroy {\n\n\n  @Input()\n  data: number[][];\n\n\n  @Input()\n  errors: number[];\n\n  @Input()\n  removed: number[] = [];\n\n  @Input()\n  scaleRadius = true;\n\n  @Input()\n  scaleWidth = false;\n\n  @Input()\n  showIndividuals: ShowIndividualsOptions = 'selected';\n\n  @Input()\n  set domain(domain: [number, number]) {\n    this._domain = [domain[0], domain[1], domain[1] - domain[0]];\n  }\n\n  @Input()\n  palette: string[] = [];\n\n  @Input()\n  labels: string[] = [];\n\n  @Input()\n  labelsOn = true;\n\n\n  @Input()\n  lookAndFeel = new LookAndFeel();\n\n  @Output()\n  colors = new EventEmitter<string[]>();\n\n  private d3: D3;\n  private parentNativeElement: any;\n  private polarUtil: PolarDomainUtil;\n  private d3Svg: Selection<SVGSVGElement, any, null, undefined>;\n\n\n  private _domain: number[];\n  private showAllIndividuals = false;\n  private showSelectedIndividuals = false;\n\n  //private individualPolarData: PolarPoint[][];\n\n  private graphicContext = new GraphicContext();\n\n\n  constructor(private ngZone: NgZone, private changeDetectorRef: ChangeDetectorRef, element: ElementRef) {\n    this.d3 = d3;\n    // this.d3 = d3Service.getD3();\n    this.parentNativeElement = element.nativeElement;\n    this.polarUtil = new PolarDomainUtil();\n\n  }\n\n\n  /**\n   * It is detached from angular to prevent unnecessary change detection\n   */\n  ngAfterViewInit() {\n    this.changeDetectorRef.detach();\n  }\n\n  /**\n   * Explicit triggers re-drawing as need to have all the parameters set (so will not redrawn if data came frist and domain later)\n   * @param changes\n   */\n  ngOnChanges(changes: SimpleChanges) {\n\n    if (!this.data || !this._domain) {\n      return;\n    }\n\n    // console.log(\"Changes\", changes);\n\n    this.showSelectedIndividuals = (this.showIndividuals === 'selected');\n\n    this.showAllIndividuals = (this.showIndividuals === 'all');\n\n    this.updatePlot();\n\n  }\n\n\n  ngOnInit() {\n\n    if (this.parentNativeElement !== null) {\n\n    } else {\n      console.error('Missing parrent element for the component');\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.d3Svg && this.d3Svg.empty && !this.d3Svg.empty()) {\n      this.d3Svg.selectAll('*').remove();\n    }\n  }\n\n\n  initializeSvg(): GraphicContext {\n\n    const pWidth = 500;\n    const pHeight = 500;\n\n    const d3ParentElement = this.d3.select(this.parentNativeElement);\n    this.d3Svg = d3ParentElement.select('.polarplot').append<SVGSVGElement>('svg');\n\n\n    this.d3Svg.attr('width', '100%')\n      .attr('viewBox', '0 0 ' + pWidth + ' ' + pHeight);\n\n    const context = new GraphicContext();\n    context.mainPane = this.d3Svg.append<SVGGElement>('g')\n      .attr('transform', 'translate(' + (pWidth / 2) + ',' + (pHeight / 2) + ')'); // moves 0,0 of the pain to the middle of the graphics\n\n    context.radius = Math.min(pWidth, pHeight) / 2 - 30;\n    return context;\n  }\n\n  prepareLegendtip(context: GraphicContext): GraphicContext {\n\n    if (!context.legendtip) {\n      // Set up the small tooltip in the centre for when you hover over a circle\n      context.legendtip = context.mainPane.append<SVGGElement>('g')\n        .classed('legendtipWrapper', true) as any;\n\n      context.legendtipBox = context.legendtip.append<SVGGElement>('rect')\n        .style('fill', 'white')\n        .style('fill-opacity', 0.9)\n        .style('stroke', 'grey')\n      ;\n\n\n      context.legendtipText = context.legendtip.append('text')\n        .attr('class', 'legendtip')\n        .attr('text-anchor', 'middle')\n        // .attr(\"dy\", \"0.35em\")\n        // .style(\"font-size\", this.lookAndFeel.tooltipFontSize) //\"11px\")\n        .style('opacity', 1) as any\n      ;\n\n      context.legendtip\n      // .style(\"visibility\", \"hidden\");\n        .style('display', 'none');\n    }\n    return context;\n  }\n\n  showLegendtip(p: PetalNode, radius: number) {\n\n    if (!this.labelsOn) {\n      return;\n    }\n\n    this.graphicContext.legendtipText\n      .attr('x', 0)\n      .attr('y', 0)\n      .text(p.label)\n    // .transition().duration(this.lookAndFeel.baseTransitionsTime / 2)\n    // .style('opacity', 1);\n    ;\n\n    // it has to be before the box cause of the bug in firefox\n    this.graphicContext.legendtip\n      // .style(\"visibility\", \"visible\");\n      .style('display', null);\n\n    const bbox = this.graphicContext.legendtipText.node().getBBox();\n\n    this.graphicContext.legendtipBox\n      .attr('x', bbox.x - 3)\n      .attr('y', bbox.y - 2)\n      .attr('width', bbox.width + 6)\n      .attr('height', bbox.height + 4);\n\n\n  }\n\n  hideLegendtip() {\n\n    this.graphicContext.legendtip\n    // .style(\"visibility\", \"hidden\");\n      .style('display', 'none');\n  }\n\n\n  prepareTooltip(context: GraphicContext): GraphicContext {\n\n    if (!context.tooltip) {\n      // Set up the small tooltip for when you hover over a circle\n      context.tooltip = context.mainPane.append<SVGGElement>('g')\n        .classed('tooltipWrapper', true) as any;\n\n      context.tooltipBox = context.tooltip.append<SVGGElement>('rect')\n        .style('fill', 'white')\n        .style('fill-opacity', 0.8)\n        .style('stroke', 'grey')\n      // .style(\"visibility\", \"hidden\");\n      ;\n\n\n      context.tooltipText = context.tooltip.append('text')\n        .attr('class', 'tooltip')\n        .attr('text-anchor', 'middle')\n        .attr('dy', '0.35em')\n        // .style(\"font-size\", this.lookAndFeel.tooltipFontSize) //\"11px\")\n        .style('opacity', 1) as any\n      ;\n\n      context.tooltip\n      // .style(\"visibility\", \"hidden\");\n        .style('display', 'none');\n    }\n    return context;\n  }\n\n  showTooltip(p: PetalNode, radius: number) {\n\n\n    this.graphicContext.tooltipText\n      .attr('x', (radius + 15) * p.polarCoordinates[0])\n      .attr('y', (radius + 15) * p.polarCoordinates[1])\n      .text(p.roundedPeak)\n    // .transition().duration(this.lookAndFeel.baseTransitionsTime / 2)\n    // .style('opacity', 1);\n    ;\n\n    // it has to be before the get BBox cause of the firefox errors\n    this.graphicContext.tooltip\n      // .style(\"visibility\", \"visible\");\n      .style('display', null);\n\n    const bbox = this.graphicContext.tooltipText.node().getBBox();\n\n    this.graphicContext.tooltipBox\n      .attr('x', bbox.x - 3)\n      .attr('y', bbox.y - 2)\n      .attr('width', bbox.width + 6)\n      .attr('height', bbox.height + 4);\n\n\n  }\n\n  hideTooltip() {\n    // this.graphicContext.tooltip\n    // .transition().duration(this.lookAndFeel.baseTransitionsTime / 2)\n    // .style(\"opacity\", 0);\n\n    this.graphicContext.tooltip\n    // .style(\"visibility\", \"hidden\");\n      .style('display', 'none');\n  }\n\n\n  updatePlot() {\n\n    if (!this.d3Svg) {\n      this.graphicContext = this.initializeSvg();\n\n      this.graphicContext = this.plotAxisGrid(this.graphicContext);\n    }\n\n\n    // the grid is plotted only once, only the lables are updated\n    this.updateAxisLabels(this._domain, this.graphicContext.axisGrid);\n\n    this.graphicContext = this.updatePalette(this.data, this.palette, this.graphicContext);\n\n\n    const petalNodes = this.prepareDataModel(this.data, this._domain, this.scaleRadius, this.scaleWidth, this.errors,\n      this.labels, this.removed, this.graphicContext.palette);\n\n\n    //this.individualPolarData = this.prepareIndividualPolarData(this.data, this._domain, this.removed, this.graphicContext.palette);\n    //this.individualPolarData = this.individualPolarData.filter(d => d.length !== 0);\n\n    this.graphicContext = this.plotDataPetals(petalNodes, this.scaleRadius, this.scaleWidth, this.graphicContext);\n\n    this.graphicContext = this.plotAllDataDots(petalNodes, this.showAllIndividuals, this.graphicContext);\n\n    this.graphicContext = this.prepareIndividualDataInset(this.graphicContext);\n\n    this.graphicContext = this.prepareTooltip(this.graphicContext);\n    this.graphicContext = this.prepareLegendtip(this.graphicContext);\n\n  }\n\n  prepareDataModel(dataGroups: number[][], domain: number[],\n                   scaleRadius: boolean, scaleWidth: boolean, errors: number[],\n                   labels: string[], removed: number[],\n                   palette: string[]): PetalNode[] {\n\n    let petalNodes = this.polarUtil.dataToPetals(this.data, this._domain, this.scaleRadius, this.scaleWidth, this.errors);\n\n    this.labelPetals(petalNodes, labels);\n    this.colorPetals(petalNodes, palette);\n    // mark hidden\n    removed.forEach( ix => {\n      if (petalNodes[ix]) {\n        petalNodes[ix].hidden = true;\n        petalNodes[ix].individuals.forEach( p => p.hidden = true);\n      }\n    });\n    // petalNodes = petalNodes.filter(n => !n.hidden);\n\n    // remove empty data\n    petalNodes = petalNodes.filter(n => !isNaN(n.peak));\n    return petalNodes;\n  }\n\n  updatePalette(data: any[], palette: string[], context: GraphicContext): GraphicContext {\n    if (!palette || palette.length === 0) {\n      context.palette = BD2ColorPalette.palette(data.length);\n    } else {\n      context.palette = BD2ColorPalette.extendPalette(palette, data.length);\n\n    }\n    this.colors.next(context.palette.slice());\n    return context;\n  }\n\n  labelPetals(petals: PetalNode[], labels: string[]) {\n    if (!labels) {\n      labels = [];\n    }\n\n    petals.forEach((n, ix) => n.label = labels[ix] ? labels[ix] : '' + (ix + 1));\n  }\n\n  colorPetals(petals: PetalNode[], palette: string[]) {\n    petals.forEach((b, ix) => {\n      b.color = palette[ix];\n      b.individuals.forEach( p => p.color = b.color);\n    });\n  }\n\n  plotDataPetals(petalNodes: PetalNode[],\n                 scaleRadius: boolean, scaleWidth: boolean,\n                 context: GraphicContext): GraphicContext {\n\n    const transitionsTime = this.lookAndFeel.baseTransitionsTime;\n    const d3 = this.d3;\n    const radius = context.radius;\n\n    if (!context.petalsWrapper) {\n      context.petalsWrapper = context.mainPane.append<SVGGElement>('g').attr('class', 'petalsWrapper');\n    }\n\n    const petalsWrapper = context.petalsWrapper;\n\n    const petalLine = (p: PetalNode) => {\n\n      return d3.lineRadial()\n        .radius(function(d) {\n          return radius * d[0];\n        })\n        .angle(function(d) {\n          return d[1];\n        })\n        .curve(d3.curveCardinalClosed)(p.petalPath as any);\n    };\n\n    const instance = this;\n\n    // so that angular change detection is not triggered for mouseover/our events or transitions\n    this.ngZone.runOutsideAngular(() => {\n\n      const petals = petalsWrapper.selectAll('.petal')\n        .data(petalNodes);\n\n\n      const petalAreaOpacity = this.lookAndFeel.petalAreaOpacity;\n\n      petals\n        .select('.petalsArea')\n        .transition().duration(transitionsTime)\n        .attr('d', petalLine as any)\n        .style('fill', d => d.color)\n        .style('fill-opacity', this.lookAndFeel.petalAreaOpacity)\n        .on('interrupt', function(d: PetalNode) {\n          d3.select(this)\n            .attr('d', petalLine as any)\n            .style('fill', _ => d.color)\n            .style('fill-opacity', petalAreaOpacity);\n        })\n      ;\n\n      petals\n        .select('.petalsLine')\n        .transition().duration(transitionsTime)\n        .attr('d', petalLine as any)\n        .style('stroke', d => d.color)\n        .style('stroke-opacity', 1)\n        .style('stroke-width', this.lookAndFeel.petalLineWidth)\n        .on('interrupt', function( d: PetalNode) {\n          d3.select(this)\n            .attr('d', petalLine as any)\n            .style('stroke', _ => d.color)\n            .style('stroke-opacity', 1);\n        })\n      ;\n\n      petals\n        .select('.petalsCircle')\n        .transition().duration(transitionsTime)\n        .attr('cx', function(d: PetalNode, i) {\n          return radius * d.polarCoordinates[0]; // Math.cos(d * 2 * Math.PI / 24 - Math.PI / 2);\n        })\n        .attr('cy', function(d: PetalNode, i) {\n          return radius * d.polarCoordinates[1]; // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        })\n        .style('fill', d => d.color)\n        .on('interrupt', function(d: PetalNode) {\n          d3.select(this)\n            .attr('cx', function(_: PetalNode, i) {\n              return radius * d.polarCoordinates[0]; // Math.cos(d * 2 * Math.PI / 24 - Math.PI / 2);\n            })\n            .attr('cy', function(_: PetalNode, i) {\n              return radius * d.polarCoordinates[1]; // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n            })\n            .style('fill', _ => d.color);\n        })\n      ;\n\n      const newPetals = petals\n        .enter()\n        .append<SVGGElement>('g')\n        .attr('class', 'petal');\n\n\n      const petalsArea = newPetals.append('path');\n\n      petalsArea\n        .attr('class', 'petalsArea')\n        .attr('d', petalLine as any)\n        .style('fill', d => d.color)\n        .style('fill-opacity', 0)\n        .on('mouseover', function(evt: MouseEvent, d: PetalNode) {\n\n          d3.select(this)\n            .transition().duration(transitionsTime)\n            .style('fill-opacity', instance.lookAndFeel.petalAreaOpacityActive);\n\n          instance.showTooltip(d, radius);\n          instance.showLegendtip(d, radius);\n\n          /*const e = petalsArea.nodes();\n          console.log(\"Nodes\",e);\n          console.log(\"T\", this);\n          console.log(\"S\",d3.select(this));\n          const ix = e.indexOf(this);\n          */\n\n          instance.showIndividualDataInset(d, radius);\n\n        })\n        .on('mouseout', function() {\n\n          d3.select(this)\n            .transition().duration(transitionsTime)\n            .style('fill-opacity', instance.lookAndFeel.petalAreaOpacity);\n\n          instance.hideTooltip();\n          instance.hideLegendtip();\n          instance.hideIndividualDataInset();\n\n        })\n        .transition().duration(transitionsTime)\n        .style('fill-opacity', this.lookAndFeel.petalAreaOpacity)\n      ;\n\n      newPetals\n        .append('path')\n        .style('stroke-opacity', 0)\n        .transition().duration(transitionsTime)\n        .attr('class', 'petalsLine')\n        .attr('d', petalLine as any)\n        .style('stroke-width', this.lookAndFeel.petalLineWidth)\n        .style('stroke', d => d.color)\n        .style('fill', 'none')\n        .style('stroke-opacity', 1)\n      ;\n      // .style(\"filter\" , \"url(#glow)\");\n\n      // Append the circles\n      newPetals\n        .append('circle')\n        .attr('class', 'petalsCircle')\n        .attr('cx', function(d: PetalNode, i) {\n          return radius * d.polarCoordinates[0]; // Math.cos(d * 2 * Math.PI / 24 - Math.PI / 2);\n        })\n        .attr('cy', function(d: PetalNode, i) {\n          return radius * d.polarCoordinates[1]; // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        })\n        .attr('r', this.lookAndFeel.petalCircleRadius)\n        .style('fill', d => d.color)\n        .style('fill-opacity', this.lookAndFeel.petalCircleOpacity);\n\n      petals.exit()\n        // .transition().duration(transitionsTime / 2)\n        // .style('opacity', 0.0)\n        .remove();\n\n      const petalsAll: Selection<SVGGElement, PetalNode, null, undefined> = petalsWrapper.selectAll('.petal')\n        // .style(\"visibility\", (n:PetalNode) => n.hidden ? \"hidden\":\"visible\");\n        .style('display', (n: PetalNode) => n.hidden ? 'none' : null) as any;\n\n    });\n\n    return context;\n  }\n\n  /*\n  prepareIndividualPolarData(dataGroups: number[][], domain: number[],\n                             removed: number[], palette: string[]): PolarPoint[][] {\n    // append group index to the data so the colors can be generated for each data point (ix is for the parrent so it would\n    // not be available\n    const ind = dataGroups.map((g, ix) => g.map(a => {\n      const v = new PolarPoint(this.polarUtil.calculatePolarCoordinate(a, domain), palette[ix]);\n      return v;\n    }));\n    removed.forEach (ix => {\n      if (ind[ix]) {\n        ind[ix].forEach(p => p.hidden = true);\n      }\n    });\n    return ind;\n  }*/\n\n  prepareIndividualDataInset(context: GraphicContext): GraphicContext {\n\n    if (!context.individualDotsInsetWrapper) {\n      context.individualDotsInsetWrapper = context.mainPane.append<SVGGElement>('g').attr('class', 'dotsInset');\n    }\n\n    // the actual plotting happens in showIndividuals as it is data depended\n\n    // we always hide it with new data first;\n    this.hideIndividualDataInset();\n    return context;\n  }\n\n  hideIndividualDataInset() {\n    if (!this.graphicContext.individualDotsInsetWrapper) {\n      return;\n    }\n\n    this.graphicContext.individualDotsInsetWrapper\n      .style('opacity', 0.0);\n  }\n\n  showIndividualDataInset(p: PetalNode, radius: number) {\n\n    if (!this.graphicContext.individualDotsInsetWrapper || !p.individuals || !this.showSelectedIndividuals) {\n      return;\n    }\n\n    // console.log(\"P: \"+p.polarCoordinates[0], p.polarCoordinates);\n\n    const transitionsTime = this.lookAndFeel.baseTransitionsTime / 2;\n\n    const d3 = this.d3;\n\n    // console.log(\"Ix\",ix);\n    // console.log(\"D\",this.individualPolarData[ix]);\n    const individuals = p.individuals; // this.individualPolarData[ix];\n\n\n    const dots = this.graphicContext.individualDotsInsetWrapper.selectAll('.dotsCircle')\n      .data(individuals);\n\n    // existing dots\n    dots\n      .interrupt()\n      .style('opacity', 0.2)\n      .attr('cx', radius * p.polarCoordinates[0])\n      .attr('cy', radius * p.polarCoordinates[1])\n      .style('stroke', p.color)\n      .style('fill', p.color)\n      .transition().duration(transitionsTime)\n      .style('opacity', 1)\n      .attr('cx', d => radius * d.xy[0])\n      .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n    ;\n\n    // new dots\n    dots.enter()\n      .append('circle')\n      .style('opacity', 0.2)\n      .attr('class', 'dotsCircle')\n      .attr('cx', radius * p.polarCoordinates[0])\n      .attr('cy', radius * p.polarCoordinates[1])\n      .attr('r', this.lookAndFeel.dotsCircleRadius)\n      .style('stroke-width', this.lookAndFeel.dotsCircleStrokeWidth)\n      .style('stroke', p.color)\n      .style('fill', p.color)\n      .style('fill-opacity', this.lookAndFeel.dotsCircleFillOpacity)\n      .transition().duration(transitionsTime)\n      .style('opacity', 1)\n      .attr('cx', d => radius * d.xy[0])\n      .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n    ;\n    // exit\n    dots.exit()\n      .remove();\n\n    this.graphicContext.individualDotsInsetWrapper\n      .style('opacity', 1);\n  }\n\n  plotAllDataDots(petals: PetalNode[], showDots: boolean,\n                  context: GraphicContext): GraphicContext {\n\n\n    const transitionsTime = this.lookAndFeel.baseTransitionsTime;\n    const d3 = this.d3;\n    const radius = context.radius;\n\n    if (!context.dotsWrapper) {\n      context.dotsWrapper = context.mainPane.append<SVGGElement>('g').attr('class', 'dotsWrapper');\n    }\n    const dotsWrapper = context.dotsWrapper;\n\n    if (!showDots) {\n      context.dotsWrapper.style('opacity', 0.0);\n      return context;\n    } else {\n      context.dotsWrapper.style('opacity', 1);\n    }\n\n    const dotsData = petals.map(p => p.individuals);\n    const instance = this;\n\n\n    // so that angular change detection is not triggered for mouseover/our events or transitions\n    this.ngZone.runOutsideAngular(() => {\n\n      const dotsGroup = dotsWrapper.selectAll('.dotsGroup')\n        .data(dotsData);\n\n\n      const dotsInExisting = dotsGroup.selectAll('.dotsCircle')\n        .data(d => d);\n\n      dotsInExisting\n        .transition().duration(transitionsTime)\n        .attr('cx', d => radius * d.xy[0])\n        .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        .style('stroke', d => d.color)\n        .style('fill', d => d.color)\n      ;\n\n      dotsInExisting.enter()\n        .append('circle')\n        .attr('class', 'dotsCircle')\n        .transition().duration(transitionsTime)\n        .attr('cx', d => radius * d.xy[0])\n        .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        .attr('r', this.lookAndFeel.dotsCircleRadius)\n        .style('stroke-width', this.lookAndFeel.dotsCircleStrokeWidth)\n        .style('stroke', d => d.color)\n        .style('fill', d => d.color)\n        .style('fill-opacity', this.lookAndFeel.dotsCircleFillOpacity);\n\n\n      dotsInExisting.exit()\n        .transition().duration(transitionsTime / 2)\n        .style('opacity', 0.0)\n        .remove();\n\n      // dotsGroup enter section\n      const dotsInNewGroups = dotsGroup.enter()\n        .append<SVGGElement>('g')\n        .attr('class', 'dotsGroup')\n        .selectAll('.dotsCircle')\n        .data(d => d);\n\n\n      dotsInNewGroups.enter()\n        .append('circle')\n        .attr('class', 'dotsCircle')\n        .transition().duration(transitionsTime)\n        .attr('cx', d => radius * d.xy[0])\n        .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        .attr('r', this.lookAndFeel.dotsCircleRadius)\n        .style('stroke-width', this.lookAndFeel.dotsCircleStrokeWidth)\n        .style('stroke', d => d.color)\n        .style('fill', d => d.color)\n        .style('fill-opacity', this.lookAndFeel.dotsCircleFillOpacity);\n\n      // dotsGroup exit section\n      dotsGroup.exit()\n        .transition().duration(transitionsTime / 2)\n        .style('opacity', 0.0)\n        .remove();\n\n    });\n\n    const dotsGroup = dotsWrapper// .selectAll(\".dotsGroup\")\n      .selectAll('.dotsCircle')\n      // .style(\"visibility\", (n:PolarPoint) => n.hidden ? \"hidden\":\"visible\");\n      .style('display', (n: PolarPoint) => n.hidden ? 'none' : null);\n\n    return context;\n  }\n\n  /*\n  plotAllDataDots(dotsData: PolarPoint[][], showDots: boolean,\n                  context: GraphicContext): GraphicContext {\n\n\n    const transitionsTime = this.lookAndFeel.baseTransitionsTime;\n    const d3 = this.d3;\n    const radius = context.radius;\n\n    if (!context.dotsWrapper) {\n      context.dotsWrapper = context.mainPane.append<SVGGElement>('g').attr('class', 'dotsWrapper');\n    }\n    const dotsWrapper = context.dotsWrapper;\n\n    if (!showDots) {\n      context.dotsWrapper.style('opacity', 0.0);\n      return context;\n    } else {\n      context.dotsWrapper.style('opacity', 1);\n    }\n\n    const instance = this;\n\n\n    // so that angular change detection is not triggered for mouseover/our events or transitions\n    this.ngZone.runOutsideAngular(() => {\n\n      const dotsGroup = dotsWrapper.selectAll('.dotsGroup')\n        .data(dotsData);\n\n\n      const dotsInExisting = dotsGroup.selectAll('.dotsCircle')\n        .data(d => d);\n\n      dotsInExisting\n        .transition().duration(transitionsTime)\n        .attr('cx', d => radius * d.xy[0])\n        .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        .style('stroke', d => d.color)\n        .style('fill', d => d.color)\n      ;\n\n      dotsInExisting.enter()\n        .append('circle')\n        .attr('class', 'dotsCircle')\n        .transition().duration(transitionsTime)\n        .attr('cx', d => radius * d.xy[0])\n        .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        .attr('r', this.lookAndFeel.dotsCircleRadius)\n        .style('stroke-width', this.lookAndFeel.dotsCircleStrokeWidth)\n        .style('stroke', d => d.color)\n        .style('fill', d => d.color)\n        .style('fill-opacity', this.lookAndFeel.dotsCircleFillOpacity);\n\n\n      dotsInExisting.exit()\n        .transition().duration(transitionsTime / 2)\n        .style('opacity', 0.0)\n        .remove();\n\n      // dotsGroup enter section\n      const dotsInNewGroups = dotsGroup.enter()\n        .append<SVGGElement>('g')\n        .attr('class', 'dotsGroup')\n        .selectAll('.dotsCircle')\n        .data(d => d);\n\n\n      dotsInNewGroups.enter()\n        .append('circle')\n        .attr('class', 'dotsCircle')\n        .transition().duration(transitionsTime)\n        .attr('cx', d => radius * d.xy[0])\n        .attr('cy', d => radius * d.xy[1]) // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n        .attr('r', this.lookAndFeel.dotsCircleRadius)\n        .style('stroke-width', this.lookAndFeel.dotsCircleStrokeWidth)\n        .style('stroke', d => d.color)\n        .style('fill', d => d.color)\n        .style('fill-opacity', this.lookAndFeel.dotsCircleFillOpacity);\n\n      // dotsGroup exit section\n      dotsGroup.exit()\n        .transition().duration(transitionsTime / 2)\n        .style('opacity', 0.0)\n        .remove();\n\n    });\n\n    const dotsGroup = dotsWrapper// .selectAll(\".dotsGroup\")\n      .selectAll('.dotsCircle')\n      // .style(\"visibility\", (n:PolarPoint) => n.hidden ? \"hidden\":\"visible\");\n      .style('display', (n: PolarPoint) => n.hidden ? 'none' : null);\n\n    return context;\n  }\n  */\n\n  plotAxisGrid(context: GraphicContext): GraphicContext {\n\n\n    if (context.axisGrid) {\n      return context; // this.axisGrid; //we only plot grid once\n    }\n\n    const radius = context.radius;\n    const axisGrid = context.axisGrid = context.mainPane.append<SVGGElement>('g').attr('class', 'axisWrapper');\n\n\n    axisGrid.selectAll('.levels')\n      .data([10, 2, 1])\n      .enter()\n      .append('circle')\n      .attr('class', 'gridCircle')\n      .attr('r', function(d, i) {\n        return radius / d;\n      })\n      .style('fill', this.lookAndFeel.gridColor)\n      .style('stroke', this.lookAndFeel.gridColor)\n      .style('fill-opacity', 0.15);\n    // .style(\"filter\" , \"url(#glow)\");\n\n    const axis = axisGrid.selectAll('.axis')\n      .data(\n        [0, 3, 6, 9, 12, 15, 18, 21].map(v => this.polarUtil.normalizedPeakToPolar(v, 24)\n          // polar coordinates with attached original value for the label\n        )\n      )\n      .enter()\n      .append('g')\n      .attr('class', 'axis');\n\n    axis.append('line')\n      .attr('x1', 0)\n      .attr('y1', 0)\n      .attr('x2', function(d, i) {\n        return radius * d[0]; // Math.cos(d * 2 * Math.PI / 24 - Math.PI / 2);\n      })\n      .attr('y2', function(d, i) {\n        return radius * d[1]; // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n      })\n      .attr('class', 'line')\n      .style('stroke', this.lookAndFeel.axisColor)\n      .style('stroke-dasharray', '5 5')\n      .style('stroke-width', this.lookAndFeel.axisWidth);\n\n    axis.append('text')\n      .attr('class', 'legend')\n      // .style(\"font-size\", this.lookAndFeel.axisFontSize) //\"10px\")\n      .attr('text-anchor', 'middle')\n      .attr('dy', '0.35em')\n      .attr('x', function(d, i) {\n        return (radius + 15) * d[0]; // Math.cos(d * 2 * Math.PI / 24 - Math.PI / 2);\n      })\n      .attr('y', function(d, i) {\n        return (radius + 15) * d[1]; // Math.sin(d * 2 * Math.PI / 24 - Math.PI / 2);\n      })\n      .text(function(d, i) {\n        return d[2];\n      });\n\n    return context;\n  }\n\n  updateAxisLabels(domain: number[], axisGrid: Selection<SVGGElement, any, null, undefined>) {\n\n    const range = domain[1] - domain[0];\n    const axis = axisGrid.selectAll('.axis');\n    axis.select('text')\n      .text(function(d, i) {\n        if (i === 0) {\n          return SmartRounder.round(domain[1]) + ' / ' + SmartRounder.round(domain[0]);\n        } else {\n          return SmartRounder.round(domain[0] + d[2] / 24 * range);\n        }\n      });\n\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport {PolarPlotComponent} from './polar-plot/polar-plot.component';\nimport {CommonModule} from '@angular/common';\n\n\n\n\n@NgModule({\n  declarations: [PolarPlotComponent],\n  imports: [\n    // CommonModule\n  ],\n  exports: [PolarPlotComponent]\n})\nexport class BD2NgxPolarplotModule { }\n","/*\n * Public API Surface of bd2-ngx-polarplot\n */\n\n\nexport * from './lib/bd2-ngx-polarplot.module';\nexport * from './lib/polar-plot/polar-plot.component'\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["interval","take","BD2ColorPalette","i0","AppComponent","constructor","generateData","toggleRemoved","removed","length","toggleHidden","hidden","value","console","log","i","show","generateDelayedData","s","pipe","subscribe","v","generateDataInner","err","unsubscribe","nrBase","increase","series","Math","floor","random","rows","push","len","mean","row","j","x","round","LET","labels","map","ix","label","data","palette","selectors","decls","vars","consts","template","ctx","BrowserModule","FormsModule","BD2NgxPolarplotModule","AppModule","bootstrap","declarations","imports","environment","production","enableProdMode","__NgCli_bootstrap_1","bootstrapModule","catch","error","extendPalette","size","out","schemeCategory10","schemeCategory20","d3","d3lib","PolarPoint","xy","color","PetalNode","SmartRounder","base","abs","DEF_ERR","DEF_WIDTH","MIN_WIDTH","NEGLIGIBLE_ERROR","MAX_ERROR","PolarDomainUtil","dataToPetals","dataGroups","domain","scaleRadius","scaleWidth","errors","g","dataToPetal","node","calculatePetalProperties","polarAngle","calculatePolarAngle","peak","petalPath","calculatePetalPath","width","radiusScale","polarCoordinates","calculatePolarCoordinate","individuals","dataToPolarPoint","ind","a","undefined","calculateCircularMeanAndDev","normalize","m","std","deviation","rot","rotM","rotStd","meanStd","roundedPeak","path","normalizedPeakToPolar","range","cos","PI","sin","GraphicContext","LookAndFeel","PolarPlotComponent","_domain","ngZone","changeDetectorRef","element","EventEmitter","parentNativeElement","nativeElement","polarUtil","ngAfterViewInit","detach","ngOnChanges","changes","showSelectedIndividuals","showIndividuals","showAllIndividuals","updatePlot","ngOnInit","ngOnDestroy","d3Svg","empty","selectAll","remove","initializeSvg","pWidth","pHeight","d3ParentElement","select","append","attr","context","mainPane","radius","min","prepareLegendtip","legendtip","classed","legendtipBox","style","legendtipText","showLegendtip","p","labelsOn","graphicContext","text","bbox","getBBox","y","height","hideLegendtip","prepareTooltip","tooltip","tooltipBox","tooltipText","showTooltip","hideTooltip","plotAxisGrid","updateAxisLabels","axisGrid","updatePalette","petalNodes","prepareDataModel","plotDataPetals","plotAllDataDots","prepareIndividualDataInset","labelPetals","colorPetals","forEach","filter","n","isNaN","colors","next","slice","petals","b","transitionsTime","lookAndFeel","baseTransitionsTime","petalsWrapper","petalLine","lineRadial","d","angle","curve","curveCardinalClosed","instance","runOutsideAngular","petalAreaOpacity","transition","duration","on","_","petalLineWidth","newPetals","enter","petalsArea","evt","petalAreaOpacityActive","showIndividualDataInset","hideIndividualDataInset","petalCircleRadius","petalCircleOpacity","exit","petalsAll","individualDotsInsetWrapper","dots","interrupt","dotsCircleRadius","dotsCircleStrokeWidth","dotsCircleFillOpacity","showDots","dotsWrapper","dotsData","dotsGroup","dotsInExisting","dotsInNewGroups","gridColor","axis","axisColor","axisWidth","inputs","outputs","features","Component","args","selector","changeDetection","OnPush","styles","Input","Output","NgModule","exports"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}